unit Statistics;

interface

uses
  Winapi.Windows, Winapi.Messages, System.SysUtils, System.Variants, System.Classes, Vcl.Graphics,
  Vcl.Controls, Vcl.Forms, Vcl.Dialogs, Vcl.Grids, Vcl.StdCtrls, ClassesListsCore, ClassesCore, UsersListsCore;

type
  TForm5 = class(TForm)
    StringGrid1: TStringGrid;
    ClassesStatisticsLabel: TLabel;
    SubjectsStatisticsLabel: TLabel;
    ClassesComboBox: TComboBox;
    SubjectsComboBox: TComboBox;
    ThirdButtonStatistics: TButton;
    ForthButtonStatistics: TButton;
    SecondButtonStatistics: TButton;
    FirstButtonStatistics: TButton;
    procedure FormCreate(Sender: TObject);
    procedure SubjectsComboBoxChange(Sender: TObject);
    procedure ClassesComboBoxChange(Sender: TObject);
    procedure FormShow(Sender: TObject);
    procedure cleanPupils();
    procedure drawPupils();
  private
    { Private declarations }
  public
    { Public declarations }
  end;

var
  Form5: TForm5;

implementation

{$R *.dfm}

procedure TForm5.cleanPupils();
var
  i,j: integer;
begin
  for i := 0 to 3 do
    begin
      for j := 1 to 100 do
       StringGrid1.Cells[i,j] := '';
    end;
end;


procedure TForm5.ClassesComboBoxChange(Sender: TObject);
begin
  cleanPupils();
  drawpupils();
end;

procedure TForm5.drawPupils();
var i,j,cnt: integer;
    UsersList: UsersListsCore.TList;
    curr: UsersListsCore.PTListElement;
    _class:  ClassesListsCore.T_Class;
begin
  UsersListsCore.LoadList(UsersList);
  New(curr);
  curr:=UsersList.head;
  cnt:=0;
  _class:= ClassesCore.getclassbyname(classesCombobox.text);
  while curr <> nil do
    begin
      if curr.data.userType = 'pupil' then
        begin
          if curr.data.studyClassID = _class.classId then
          begin
            Stringgrid1.Cells[1
            ,cnt+1] := curr.data.lastname + ' ' +curr.data.firstname;
            Stringgrid1.Cells[0,cnt+1] := inttostr(cnt+1);
            cnt:= cnt + 1;
          end;
        end;
      curr:= curr.next;
    end;
end;

procedure TForm5.FormCreate(Sender: TObject);
begin
   StringGrid1.ColWidths[0] := 50;
   StringGrid1.ColWidths[1] := 300;
   StringGrid1.ColWidths[2] := 600;
   StringGrid1.ColWidths[3] := 600;

   StringGrid1.Cells[0, 0] := '№';
   StringGrid1.Cells[1, 0] := 'Ф.И.О.';
   StringGrid1.Cells[2, 0] := 'Пропуски';
   StringGrid1.Cells[3, 0] := 'Средний балл';
end;

procedure TForm5.FormShow(Sender: TObject);
  var
  i: integer;
  classesList: classesListsCore.TList;
  classesCurr: ClassesListsCore.PTListElement;
begin
  ClassesCombobox.Items.Clear;
  SubjectsComboBox.Items.Clear;
  classesListsCore.LoadList(classesList);
  classesCurr := classesList.head;
  SubjectsCombobox.Items.Add('Math');
  SubjectsCombobox.Items.Add('Rus');
  while classesCurr <> nil do
  begin
    ClassesCombobox.Items.Add(classesCurr.data.name);
    classesCurr := classesCurr.next;
  end;

end;

procedure TForm5.SubjectsComboBoxChange(Sender: TObject);
begin
  //pass
end;

end.
